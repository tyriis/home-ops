---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  all:
    - task: init
    - task: refresh
    - task: apply

  cloudflare:
    - task: init
    - task: apply:cloudflare

  init:
    desc: Terraform initialize IaC
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - "terraform init"

  plan:cloudflare:
    desc: Terraform plan module.cloudflare
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - "terraform plan -target=module.cloudflare"

  apply:cloudflare:
    desc: Terraform apply module.cloudflare
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - "terraform apply -target=module.cloudflare"

  plan:
    desc: Terraform plan IaC
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - "terraform plan"

  apply:
    desc: Terraform apply IaC
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - "terraform apply"

  refresh:
    desc: Terraform refresh IaC
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - "terraform apply -refresh-only"

  upgrade:
    desc: Terraform upgrade IaC
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - "terraform init -upgrade"
